Triggering a dedicated E2E Jules pipeline after Test deployment**, including **all required steps, pipeline YAML/Groovy snippets, scripts, and integration points**.

This is the **cleanest way** to integrate E2E tests in Jules without polluting your application deployment pipeline.

---

# ✅ **PATTERN B — E2E TEST PIPELINE TRIGGERED AFTER DEPLOYMENT**

### Flow:

1. **App Jules Pipeline** deploys to TEST.
2. App Jules pipeline **triggers E2E Jules Pipeline** via API.
3. E2E pipeline:

   * Starts E2E test runner environment
   * Runs Selenium headless tests (`mvn clean test`)
   * Collects Cucumber reports
   * Uploads results to **TestSight**
   * Sends status back to pipeline (optional Slack)

---

# 1. **Prerequisites**

### You need:

* **E2E pipeline** created in Jules (separate workspace).
* **Test Runner Agent** (Docker or machine) with:

  * Java 17/21
  * Maven
  * Chrome + Chromedriver
  * Node (optional)
* TestSight API credentials.
* App pipeline has permission to trigger E2E pipeline.

---

# 2. **App Deployment Pipeline (Trigger Step)**

After successfully deploying to TEST, call the **Jules Pipelines API** to trigger the E2E pipeline.

### **Groovy Step in App Pipeline**

```groovy
stage('Trigger E2E Pipeline') {
    steps {
        script {
            def triggerUrl = "https://jules.company.com/api/pipeline/v2/run"
            def token = env.JULES_API_TOKEN

            def body = [
                pipelineName: "e2e-test-pipeline",
                parameters : [
                    TEST_URL: env.TEST_URL,
                    BUILD_ID: env.BUILD_ID
                ]
            ]

            sh """
                curl -X POST ${triggerUrl} \
                    -H "Authorization: Bearer ${token}" \
                    -H "Content-Type: application/json" \
                    -d '${groovy.json.JsonOutput.toJson(body)}'
            """
        }
    }
}
```

### Parameters passed:

* `TEST_URL` — where E2E should run
* `BUILD_ID` — for mapping test runs

---

# 3. **E2E Pipeline Structure**

Create a **dedicated Jules pipeline** with stages:

```
1. Prepare Runner
2. Checkout Test Repo
3. Install Browser Drivers
4. Run Selenium Tests
5. Collect & Publish Reports
6. Upload to TestSight
7. Notify + Exit
```

---

# 4. **Full E2E Jules Pipeline Example (Groovy)**

```groovy
pipeline {
    agent { label 'selenium-runner' }

    parameters {
        string(name: 'TEST_URL', defaultValue: '', description: 'Application Test URL')
        string(name: 'BUILD_ID', defaultValue: '', description: 'Build Reference')
    }

    stages {

        stage('Checkout E2E Framework') {
            steps {
                git url: "https://github.com/org/e2e-tests.git", branch: "main"
            }
        }

        stage('Prepare Environment') {
            steps {
                sh """
                    echo "TEST_URL=${params.TEST_URL}" > test.env
                    echo "BUILD_ID=${params.BUILD_ID}" >> test.env
                """
            }
        }

        stage('Run E2E Tests') {
            steps {
                sh """
                    mvn clean test \
                      -Dapp.url=${params.TEST_URL} \
                      -Dcucumber.filter.tags="@SmokeTest" \
                      -Dchrome.options="--headless --disable-gpu"
                """
            }
        }

        stage('Archive Reports') {
            steps {
                archiveArtifacts artifacts: 'target/cucumber-reports/**', allowEmptyArchive: true
            }
        }

        stage('Upload to TestSight') {
            steps {
                sh '''
                    ./scripts/upload-testsight.sh \
                        target/cucumber-reports/cucumber.json \
                        "${BUILD_ID}" \
                        "${TEST_URL}"
                '''
            }
        }
    }

    post {
        success {
            echo "E2E pipeline completed successfully."
        }
        failure {
            echo "❌ E2E tests failed. Check Cucumber reports."
        }
    }
}
```

---

# 5. **TestSight Upload Script**

Create script: `scripts/upload-testsight.sh`

```bash
#!/bin/bash

REPORT_FILE=$1
BUILD_ID=$2
TEST_URL=$3

TS_URL="https://testsight.company.com/api/upload"
TS_TOKEN="$TESTSIGHT_API_TOKEN"

curl -X POST "$TS_URL" \
  -H "Authorization: Bearer $TS_TOKEN" \
  -F "report=@${REPORT_FILE}" \
  -F "buildId=${BUILD_ID}" \
  -F "environment=${TEST_URL}"
```

Make it executable:

```bash
chmod +x scripts/upload-testsight.sh
```

---

# 6. **Runner Configuration (Headless Selenium)**

If you use a self-hosted runner:

### Install Chrome + Chromedriver

```bash
sudo apt-get update
sudo apt-get install -y google-chrome-stable chromium-chromedriver
```

### Ensure Chrome path variables:

```bash
export CHROME_BIN=/usr/bin/google-chrome
export CHROMEDRIVER_PATH=/usr/bin/chromedriver
```

---

# 7. **Cucumber Report Format**

Make sure your Maven config outputs:

* `target/cucumber-reports/cucumber.json`
* `target/cucumber-reports/cucumber-html.html`

`pom.xml` example:

```xml
<plugin>
  <groupId>io.cucumber</groupId>
  <artifactId>cucumber-maven-plugin</artifactId>
  <version>7.15.0</version>
  <executions>
    <execution>
      <phase>test</phase>
      <goals><goal>test</goal></goals>
      <configuration>
        <pluginOptions>
          <option>json:target/cucumber-reports/cucumber.json</option>
        </pluginOptions>
      </configuration>
    </execution>
  </executions>
</plugin>
```

---

# 8. **Notifications (Optional)**

Add Slack notification:

```groovy
post {
    always {
        slackSend channel: '#e2e-alerts',
                  message: "E2E Test Run for BUILD_ID ${params.BUILD_ID} finished with status: ${currentBuild.currentResult}"
    }
}
```

---

# 9. **Validation Checklist**

| Step                   | Description                             | Status |
| ---------------------- | --------------------------------------- | ------ |
| ✔ Test URL reachable   | Runner reaches TEST URL                 |        |
| ✔ Chromedriver working | `google-chrome --version`               |        |
| ✔ TestSight API token  | Added as secret                         |        |
| ✔ Cucumber JSON exists | `target/cucumber-reports/cucumber.json` |        |
| ✔ Trigger works        | App pipeline → E2E pipeline             |        |

---

# If you want

 

Just tell me!
